{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport isEmpty from \"lodash/isEmpty\";\nimport server from \"@/promisetracker/lib/server\";\nimport config from \"@/promisetracker/config\";\nimport { formatDate } from \"@/promisetracker/utils\";\n\nfunction wp(site) {\n  const siteServer = server(site);\n  const WP_DASHBOARD_URL = process.env[`${siteServer.site}WP_DASHBOARD_URL`] || config.WP_DASHBOARD_URL;\n  const WP_DASHBOARD_API_URL = `${WP_DASHBOARD_URL}/wp-json/wp/v2`;\n  const WP_DASHBOARD_ACF_API_URL = `${WP_DASHBOARD_URL}/wp-json/acf/v3`;\n\n  async function getOptions(lang) {\n    const res = await fetch(`${WP_DASHBOARD_ACF_API_URL}/options/hurumap-site?lang=${lang}`);\n    const {\n      acf\n    } = res.ok ? await res.json() : {};\n\n    if (!acf) {\n      return {};\n    }\n\n    let actNow = null;\n\n    if (acf.act_now) {\n      actNow = {\n        actionLabel: acf.act_now.button_label,\n        description: acf.act_now.description,\n        link: acf.act_now.link,\n        title: acf.act_now.title\n      };\n    }\n\n    const footer = {\n      about: acf.about || null,\n      copyright: acf.copyright || null,\n      initiativeLogo: acf.initiative_logo || null,\n      legalLinks: acf.legal_links || null,\n      organizationLogo: acf.organization_logo || null,\n      quickLinks: acf.quick_links,\n      socialMedia: acf.social_media\n    }; // WP sets urls to false if not set\n\n    if (footer.initiativeLogo) {\n      footer.initiativeLogo.image = footer.initiativeLogo.image || null;\n    }\n\n    if (footer.organizationLogo) {\n      footer.organizationLogo.image = footer.organizationLogo.image || null;\n    }\n\n    const data = {\n      actNow,\n      footer,\n      navigation: acf.navigation || null,\n      partnerList: acf.partnerList || null,\n      promiseStatuses: acf.promiseStatuses || null,\n      subscribe: acf.subscribe || null\n    };\n    return data;\n  }\n\n  async function getResourcesBySlug(type, slug, lang, params) {\n    const fields = params !== null && params !== void 0 && params.fields ? `&_fields=${params.fields}` : \"\";\n    const embed = params !== null && params !== void 0 && params.embed ? `&_embed=${params.embed}` : \"\";\n    const res = await fetch(`${WP_DASHBOARD_API_URL}/${type}?slug=${slug}&lang=${lang}${fields}${embed}`);\n    const data = res.ok ? await res.json() : [];\n    return data;\n  }\n\n  async function getResourcesByParentId(type, parent, lang, order, orderBy) {\n    const res = await fetch(`${WP_DASHBOARD_API_URL}/${type}?parent=${parent}&order=${order}&orderby=${orderBy}&lang=${lang}`);\n    const data = res.ok ? res.json() : [];\n    return data;\n  }\n\n  async function getResourceById(type, id, lang, params) {\n    const fields = params !== null && params !== void 0 && params.fields ? `&_fields=${params.fields}` : \"\";\n    const embed = params !== null && params !== void 0 && params.embed ? `&_embed=${params.embed}` : \"\";\n    const res = await fetch(`${WP_DASHBOARD_API_URL}/${type}/${id}?lang=${lang}${fields}${embed}`);\n    const data = res.ok ? res.json() : {};\n    return data;\n  }\n\n  function createPageFrom(resource, options, lang) {\n    var _acf$criteria, _acf$partners, _resource$content, _resource$title;\n\n    const {\n      acf\n    } = resource;\n    let criteria = null;\n\n    if ((_acf$criteria = acf.criteria) !== null && _acf$criteria !== void 0 && _acf$criteria.show) {\n      criteria = {\n        title: acf.criteria.title || null,\n        items: options.promiseStatuses\n      };\n    }\n\n    acf.criteria = null;\n    let partners = null;\n\n    if ((_acf$partners = acf.partners) !== null && _acf$partners !== void 0 && _acf$partners.show) {\n      partners = {\n        title: acf.partners.title || null,\n        items: options.partnerList\n      };\n    }\n\n    acf.partners = null;\n\n    const page = _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, acf), resource), options), {}, {\n      criteria,\n      content: (_resource$content = resource.content) === null || _resource$content === void 0 ? void 0 : _resource$content.rendered,\n      partners,\n      featuredImage: resource.featured_image_src,\n      title: (_resource$title = resource.title) === null || _resource$title === void 0 ? void 0 : _resource$title.rendered,\n      languge: lang\n    });\n\n    return page;\n  }\n\n  async function getPagesByParentId(parent, lang, order, orderBy) {\n    const children = await getResourcesByParentId(\"pages\", parent, lang, order, orderBy);\n    const options = children.length && (await getOptions(lang));\n    const data = children.map(child => createPageFrom(child, options, lang));\n    return data;\n  }\n\n  async function getPagesByParentSlug(slug, lang, order, orderBy) {\n    const resources = await getResourcesBySlug(\"pages\", slug, lang, {\n      fields: \"id\"\n    });\n    const {\n      id\n    } = resources[0] || {};\n\n    if (id) {\n      return getPagesByParentId(id, lang, order, orderBy);\n    }\n\n    return [];\n  }\n\n  async function getPageBySlug(slug, lang) {\n    const resources = await getResourcesBySlug(\"pages\", slug, lang);\n    const resource = resources[0] || {};\n\n    if (isEmpty(resource)) {\n      return resource;\n    }\n\n    const options = await getOptions(lang);\n    return createPageFrom(resource, options, lang);\n  }\n\n  async function getPageById(id, lang) {\n    const resource = await getResourceById(\"pages\", id, lang);\n\n    if (isEmpty(resource)) {\n      return resource;\n    }\n\n    const options = await getOptions(lang);\n    return createPageFrom(resource, options, lang);\n  }\n\n  async function getPostBySlug(slug, lang) {\n    const resources = await getResourcesBySlug(\"posts\", slug, lang, {\n      embed: 1\n    });\n    const resource = resources[0];\n\n    if (isEmpty(resource)) {\n      return undefined;\n    }\n\n    const post = _objectSpread(_objectSpread({}, resource), {}, {\n      // eslint-disable-next-line no-underscore-dangle\n      author: resource._embedded.author[0],\n      content: resource.content.rendered,\n      // eslint-disable-next-line no-underscore-dangle\n      featured_media: resource._embedded[\"wp:featuredmedia\"][0],\n      title: resource.title.rendered\n    });\n\n    return post;\n  }\n\n  const api = {\n    pages: ({\n      id,\n      slug,\n      locale = siteServer.defaultLocale,\n      order = \"asc\",\n      orderBy = \"menu_order\",\n      page\n    }) => ({\n      get first() {\n        return (async () => {\n          if (id) {\n            return getPageById(id, locale);\n          }\n\n          if (slug) {\n            return getPageBySlug(slug, locale);\n          }\n\n          return page || {};\n        })();\n      },\n\n      get children() {\n        return (async () => {\n          const parentId = id || (page === null || page === void 0 ? void 0 : page.id);\n\n          if (parentId) {\n            return getPagesByParentId(parentId, locale, order, orderBy);\n          }\n\n          if (slug) {\n            return getPagesByParentSlug(slug, locale, order, orderBy);\n          }\n\n          return [];\n        })();\n      },\n\n      get posts() {\n        return (async () => {\n          var _pageWithPosts, _pageWithPosts$posts;\n\n          let pageWithPosts;\n\n          if (id) {\n            pageWithPosts = await getPageById(id, locale);\n          } else if (slug) {\n            pageWithPosts = await getPageBySlug(slug, locale);\n          } else {\n            pageWithPosts = page;\n          }\n\n          const posts = ((_pageWithPosts = pageWithPosts) === null || _pageWithPosts === void 0 ? void 0 : (_pageWithPosts$posts = _pageWithPosts.posts) === null || _pageWithPosts$posts === void 0 ? void 0 : _pageWithPosts$posts.map(post => ({\n            image: post.featured_image,\n            description: post.post_content.replace(/(<([^>]+)>)/gi, \"\"),\n            date: formatDate(post.post_date),\n            slug: post.post_name,\n            title: post.post_title\n          }))) || null;\n          return posts;\n        })();\n      }\n\n    }),\n    posts: ({\n      slug,\n      locale = siteServer.defaultLocale\n    }) => ({\n      get first() {\n        return (async () => {\n          if (slug) {\n            return getPostBySlug(slug, locale);\n          }\n\n          return undefined;\n        })();\n      }\n\n    })\n  };\n  return api;\n}\n\nexport default wp;","map":{"version":3,"sources":["/Users/cfafrica/Desktop/vercel-monorepo-setup/apps/promisetracker/src/lib/wp/index.js"],"names":["isEmpty","server","config","formatDate","wp","site","siteServer","WP_DASHBOARD_URL","process","env","WP_DASHBOARD_API_URL","WP_DASHBOARD_ACF_API_URL","getOptions","lang","res","fetch","acf","ok","json","actNow","act_now","actionLabel","button_label","description","link","title","footer","about","copyright","initiativeLogo","initiative_logo","legalLinks","legal_links","organizationLogo","organization_logo","quickLinks","quick_links","socialMedia","social_media","image","data","navigation","partnerList","promiseStatuses","subscribe","getResourcesBySlug","type","slug","params","fields","embed","getResourcesByParentId","parent","order","orderBy","getResourceById","id","createPageFrom","resource","options","criteria","show","items","partners","page","content","rendered","featuredImage","featured_image_src","languge","getPagesByParentId","children","length","map","child","getPagesByParentSlug","resources","getPageBySlug","getPageById","getPostBySlug","undefined","post","author","_embedded","featured_media","api","pages","locale","defaultLocale","first","parentId","posts","pageWithPosts","featured_image","post_content","replace","date","post_date","post_name","post_title"],"mappings":"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","sourcesContent":["import isEmpty from \"lodash/isEmpty\";\n\nimport server from \"@/promisetracker/lib/server\";\nimport config from \"@/promisetracker/config\";\nimport { formatDate } from \"@/promisetracker/utils\";\n\nfunction wp(site) {\n  const siteServer = server(site);\n  const WP_DASHBOARD_URL =\n    process.env[`${siteServer.site}WP_DASHBOARD_URL`] ||\n    config.WP_DASHBOARD_URL;\n  const WP_DASHBOARD_API_URL = `${WP_DASHBOARD_URL}/wp-json/wp/v2`;\n  const WP_DASHBOARD_ACF_API_URL = `${WP_DASHBOARD_URL}/wp-json/acf/v3`;\n\n  async function getOptions(lang) {\n    const res = await fetch(\n      `${WP_DASHBOARD_ACF_API_URL}/options/hurumap-site?lang=${lang}`\n    );\n    const { acf } = res.ok ? await res.json() : {};\n    if (!acf) {\n      return {};\n    }\n    let actNow = null;\n    if (acf.act_now) {\n      actNow = {\n        actionLabel: acf.act_now.button_label,\n        description: acf.act_now.description,\n        link: acf.act_now.link,\n        title: acf.act_now.title,\n      };\n    }\n    const footer = {\n      about: acf.about || null,\n      copyright: acf.copyright || null,\n      initiativeLogo: acf.initiative_logo || null,\n      legalLinks: acf.legal_links || null,\n      organizationLogo: acf.organization_logo || null,\n      quickLinks: acf.quick_links,\n      socialMedia: acf.social_media,\n    };\n    // WP sets urls to false if not set\n    if (footer.initiativeLogo) {\n      footer.initiativeLogo.image = footer.initiativeLogo.image || null;\n    }\n    if (footer.organizationLogo) {\n      footer.organizationLogo.image = footer.organizationLogo.image || null;\n    }\n    const data = {\n      actNow,\n      footer,\n      navigation: acf.navigation || null,\n      partnerList: acf.partnerList || null,\n      promiseStatuses: acf.promiseStatuses || null,\n      subscribe: acf.subscribe || null,\n    };\n    return data;\n  }\n  async function getResourcesBySlug(type, slug, lang, params) {\n    const fields = params?.fields ? `&_fields=${params.fields}` : \"\";\n    const embed = params?.embed ? `&_embed=${params.embed}` : \"\";\n    const res = await fetch(\n      `${WP_DASHBOARD_API_URL}/${type}?slug=${slug}&lang=${lang}${fields}${embed}`\n    );\n    const data = res.ok ? await res.json() : [];\n    return data;\n  }\n  async function getResourcesByParentId(type, parent, lang, order, orderBy) {\n    const res = await fetch(\n      `${WP_DASHBOARD_API_URL}/${type}?parent=${parent}&order=${order}&orderby=${orderBy}&lang=${lang}`\n    );\n    const data = res.ok ? res.json() : [];\n    return data;\n  }\n  async function getResourceById(type, id, lang, params) {\n    const fields = params?.fields ? `&_fields=${params.fields}` : \"\";\n    const embed = params?.embed ? `&_embed=${params.embed}` : \"\";\n    const res = await fetch(\n      `${WP_DASHBOARD_API_URL}/${type}/${id}?lang=${lang}${fields}${embed}`\n    );\n    const data = res.ok ? res.json() : {};\n    return data;\n  }\n  function createPageFrom(resource, options, lang) {\n    const { acf } = resource;\n    let criteria = null;\n    if (acf.criteria?.show) {\n      criteria = {\n        title: acf.criteria.title || null,\n        items: options.promiseStatuses,\n      };\n    }\n    acf.criteria = null;\n    let partners = null;\n    if (acf.partners?.show) {\n      partners = {\n        title: acf.partners.title || null,\n        items: options.partnerList,\n      };\n    }\n    acf.partners = null;\n    const page = {\n      ...acf,\n      ...resource,\n      ...options,\n      criteria,\n      content: resource.content?.rendered,\n      partners,\n      featuredImage: resource.featured_image_src,\n      title: resource.title?.rendered,\n      languge: lang,\n    };\n    return page;\n  }\n  async function getPagesByParentId(parent, lang, order, orderBy) {\n    const children = await getResourcesByParentId(\n      \"pages\",\n      parent,\n      lang,\n      order,\n      orderBy\n    );\n    const options = children.length && (await getOptions(lang));\n    const data = children.map((child) => createPageFrom(child, options, lang));\n    return data;\n  }\n  async function getPagesByParentSlug(slug, lang, order, orderBy) {\n    const resources = await getResourcesBySlug(\"pages\", slug, lang, {\n      fields: \"id\",\n    });\n    const { id } = resources[0] || {};\n    if (id) {\n      return getPagesByParentId(id, lang, order, orderBy);\n    }\n    return [];\n  }\n  async function getPageBySlug(slug, lang) {\n    const resources = await getResourcesBySlug(\"pages\", slug, lang);\n    const resource = resources[0] || {};\n    if (isEmpty(resource)) {\n      return resource;\n    }\n    const options = await getOptions(lang);\n    return createPageFrom(resource, options, lang);\n  }\n  async function getPageById(id, lang) {\n    const resource = await getResourceById(\"pages\", id, lang);\n    if (isEmpty(resource)) {\n      return resource;\n    }\n    const options = await getOptions(lang);\n    return createPageFrom(resource, options, lang);\n  }\n  async function getPostBySlug(slug, lang) {\n    const resources = await getResourcesBySlug(\"posts\", slug, lang, {\n      embed: 1,\n    });\n    const resource = resources[0];\n    if (isEmpty(resource)) {\n      return undefined;\n    }\n    const post = {\n      ...resource,\n      // eslint-disable-next-line no-underscore-dangle\n      author: resource._embedded.author[0],\n      content: resource.content.rendered,\n      // eslint-disable-next-line no-underscore-dangle\n      featured_media: resource._embedded[\"wp:featuredmedia\"][0],\n      title: resource.title.rendered,\n    };\n    return post;\n  }\n\n  const api = {\n    pages: ({\n      id,\n      slug,\n      locale = siteServer.defaultLocale,\n      order = \"asc\",\n      orderBy = \"menu_order\",\n      page,\n    }) => ({\n      get first() {\n        return (async () => {\n          if (id) {\n            return getPageById(id, locale);\n          }\n          if (slug) {\n            return getPageBySlug(slug, locale);\n          }\n          return page || {};\n        })();\n      },\n      get children() {\n        return (async () => {\n          const parentId = id || page?.id;\n          if (parentId) {\n            return getPagesByParentId(parentId, locale, order, orderBy);\n          }\n          if (slug) {\n            return getPagesByParentSlug(slug, locale, order, orderBy);\n          }\n          return [];\n        })();\n      },\n      get posts() {\n        return (async () => {\n          let pageWithPosts;\n          if (id) {\n            pageWithPosts = await getPageById(id, locale);\n          } else if (slug) {\n            pageWithPosts = await getPageBySlug(slug, locale);\n          } else {\n            pageWithPosts = page;\n          }\n          const posts =\n            pageWithPosts?.posts?.map((post) => ({\n              image: post.featured_image,\n              description: post.post_content.replace(/(<([^>]+)>)/gi, \"\"),\n              date: formatDate(post.post_date),\n              slug: post.post_name,\n              title: post.post_title,\n            })) || null;\n          return posts;\n        })();\n      },\n    }),\n    posts: ({ slug, locale = siteServer.defaultLocale }) => ({\n      get first() {\n        return (async () => {\n          if (slug) {\n            return getPostBySlug(slug, locale);\n          }\n          return undefined;\n        })();\n      },\n    }),\n  };\n  return api;\n}\nexport default wp;\n"]},"metadata":{},"sourceType":"module"}